<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
		html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
        }
		
        #game-area {
            position: relative;
			width: 100vw;  /* 100% ширины окна просмотра */
			height: 100vh; /* 100% высоты окна просмотра */
			background: linear-gradient(to bottom, #87CEEB, #ffffff); /* Голубое небо с плавным переходом */
            border: 1px solid #000;
			overflow: hidden;
        }

		.cloud {
			position: absolute;
			background: white;
			border-radius: 50%;
			opacity: 0.8;
			z-index: 1;
		}
		.cloud::before,
		.cloud::after {
			content: '';
			position: absolute;
			background: white;
			border-radius: 50%;
			opacity: 0.8;
		}
		.cloud {
			width: 60px;
			height: 40px;
			top: 50px; /* Положение облака */
			left: 100px; /* Положение облака */
		}
		.cloud::before {
			width: 75%;
			height: 60%;
			top: -25%;
			left: -30%;
		}

		.cloud::after {
			width: 80%;
			height: 65%;
			top: -25%;
			right: -30%;
		}
		
		.box {
            position: absolute;
            width: 30px;
            height: 20px;
            border: 2px solid red;
            background-color: transparent;
			z-index: 5;
        }
		
		.plane {
		  position: absolute;
		  top: 50%;
		  left: 50%;
		  transform: translate(-50%, -50%);
		  width: 200px;
		  height: 100px;
		  z-index: 3;
		}

		.plane::before {
		  content: '';
		  position: absolute;
		  left: 0px;
		  top: 0px;
		  width: 200px;
		  height: 100px;
		  background-color: #0088cc;
		  clip-path: polygon(20.0% 49.5%, 25.0% 25.0%, 100% 60.0%);
		  box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
		  /* Wing shadow for detail */
		}

		.plane::after {
		  content: '';
		  position: absolute;
		  left: 0px;
		  top: 0px;
		  width: 200px;
		  height: 100px;
		  background-color: #0088cc;
		  clip-path: polygon(0% 95.0%, 15.0% 65.0%, 100% 60.0%);
		  box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
		}
		
		.plane-body {
		  position: absolute;
		  top: 50%;
		  left: 50%;
		  transform: translate(-50%, -50%);
		  width: 200px;
		  height: 100px;
		  z-index: 3;
		}

		.plane-body::after {
		  content: '';
		  position: absolute;
		  left: 0px;
		  top: 0px;
		  width: 200px;
		  height: 100px;
		  background-color: #66b2ff;
		  clip-path: polygon(20.0% 49.5%, 30.0% 95%, 100% 60.0%);
		  box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
		  transform: rotate(0deg);
		}

		.bullet {
			position: absolute;
			width: 30px;
			height: 30px;
			background: radial-gradient(circle, rgba(255, 0, 255, 0.8), rgba(0, 255, 255, 0.8) 70%, rgba(0, 0, 0, 0) 100%);
			border-radius: 50%;
			box-shadow: 0 0 15px rgba(255, 0, 255, 0.7);
			transform: scaleX(1);
			animation: pulse 1s infinite, lightning 1.5s infinite;
			z-index: 2;
		}

		@keyframes pulse {
			0% {
				transform: scale(1);
				opacity: 1;
			}
			50% {
				transform: scale(1.3);
				opacity: 0.7;
			}
			100% {
				transform: scale(1);
				opacity: 1;
			}
		}

		@keyframes lightning {
			0% {
				background: radial-gradient(circle, rgba(255, 0, 255, 0.8), rgba(0, 255, 255, 0.8) 70%, rgba(0, 0, 0, 0) 100%);
			}
			50% {
				background: radial-gradient(circle, rgba(255, 255, 0, 0.8), rgba(0, 255, 255, 0.8) 70%, rgba(0, 0, 0, 0) 100%);
				box-shadow: 0 0 20px rgba(255, 255, 0, 0.7);
			}
			100% {
				background: radial-gradient(circle, rgba(255, 0, 255, 0.8), rgba(0, 255, 255, 0.8) 70%, rgba(0, 0, 0, 0) 100%);
				box-shadow: 0 0 15px rgba(255, 0, 255, 0.7);
			}
		}

        .barrel {
			position: absolute;
			width: 160px;
			height: 80px;
			background: linear-gradient(to right, blue 33%, white 33%, white 66%, red 66%);
			border: 1px solid black;
			z-index: 4;
        }
		
		.barrel-v2 {
			position: absolute;
			width: 160px;
			height: 80px;
			background-image: url('kgb-image.png'), linear-gradient(to bottom, #ffffff 33.33%, #0000ff 33.33%, #0000ff 66.66%, #ff0000 66.66%);
			background-size: contain;
			background-repeat: no-repeat;
			border: none;
			z-index: 4;
		}
		
		.explosion {
			position: absolute;
			
			border-radius: 50%;
			background: radial-gradient(circle, rgba(255,0,0,0.9), rgba(255,200,0,0.8) 50%, rgba(255,255,255,0) 100%);
			width: 50px; /* Начальный размер */
			height: 50px; /* Начальный размер */
			transform: scale(1);
			pointer-events: none; /* Не взаимодействует с пользователем */
			opacity: 0;
			z-index: 5;
		}
		
		.smoke {
			position: absolute;
			border-radius: 50%;
			background-color: rgba(0, 0, 0, 0.5); /* Полупрозрачный черный цвет */
			width: 100px; /* Начальный размер */
			height: 100px; /* Начальный размер */
			transform: scale(1);
			opacity: 0;
			pointer-events: none;
			z-index: 5;
		}

		@keyframes explosion-animation {
			0% {
				transform: scale(1);
				opacity: 1.0;
			}
			20% {
				transform: scale(1.2); /* Увеличение размера */
				opacity: 0.9;
			}
			50% {
				transform: scale(2.0); /* Увеличение размера */
				opacity: 0.5;
			}
			100% {
				transform: scale(0);
				opacity: 0;
			}
		}
		
		@keyframes smoke-animation {
			0% {
				transform: scale(1);
				opacity: 0.0;
			}
			30% {
				transform: scale(1.2);
				opacity: 0.5;
			}
			50% {
				transform: scale(2);
				opacity: 0.7;
			}
			100% {
				transform: scale(3); /* Расширение дыма */
				opacity: 0;
			}
		}

		.explosion.animate {
			animation: explosion-animation 0.3s ease-out;
		}
		
		.smoke.animate {
			animation: smoke-animation 1.0s ease-out;
		}
		
        #game-over {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            color: red;
        }
		
    </style>
    <title>Game</title>
</head>
<body>
	<audio id="background-music" autoplay loop>
        <source src="background.mp3" type="audio/mpeg">
    </audio>
	<audio id="shoot-sound">
		<source src="shoot.mp3" type="audio/mpeg">
	</audio>
	<audio id="explosion-sound">
		<source src="explosion.mp3" type="audio/mpeg">
	</audio>
	<audio id="plane-explosion-sound">
		<source src="plane-explosion.mp3" type="audio/mpeg">
	</audio>
    <div id="game-area">
	</div>
    <div id="game-over">GAME OVER</div>
    <script src="tg.js"></script>
	<script>
		function initGame() {
            if (typeof Module._init_game !== 'undefined') {
				const screenWidth = window.innerWidth;
				const screenHeight = window.innerHeight;
                Module._init_game(screenWidth, screenHeight);

                document.addEventListener('keydown', function(event) {
					Module._on_key_press(event.keyCode, 1);
                });
				
				document.addEventListener('keyup', function(event) {
					Module._on_key_press(event.keyCode, 0);
				});
				
				setInterval(() => Module._update_game(), 50);
            } else {
                console.error('init_game function is not defined');
            }
        }
		
        function cleanupGame() {
            if (typeof Module._cleanup_game !== 'undefined') {
                Module._cleanup_game();
            }
        }
		
		// Ensure the Emscripten code is fully loaded
        Module.onRuntimeInitialized = () => {
			console.info('initGame()');
			initGame();
			// window.addEventListener('beforeunload', cleanupGame());
        };
	</script>
</body>
</html>